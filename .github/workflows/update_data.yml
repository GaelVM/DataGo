name: Update Data

on:
  push:
    branches:
      - main
  schedule:
    - cron: '*/10 * * * *'  # Ejecutar cada 10 minutos

jobs:
  update-raid-data:
    runs-on: ubuntu-latest

    steps:
      # 1. Clonar el repositorio
      - name: Checkout Repository
        uses: actions/checkout@v2

      # 2. Configurar Python
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.8

      # 3. Instalar dependencias
      - name: Install Python and System Dependencies
        run: |
          pip install requests beautifulsoup4 selenium webdriver-manager
          sudo apt-get update
          wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
          sudo apt-get install -y ./google-chrome-stable_current_amd64.deb

      # 4. Ejecutar scripts Python
      - name: Run Python Scripts
        run: |
          python bosses.py
          python noticias.py
          python shinyrank.py
          python destacados.py
          python legendarios.py
          python shinys.py

      # 5. Mover archivos JSON desde temp/ a la ra√≠z
      - name: Move JSON Files to Root
        run: |
          mv temp/bossraid.json .
          mv temp/noticias.json .
          mv temp/rankshiny.json .
          mv temp/destacados.json .
          mv temp/raid_hour.json .
          mv temp/shinys.json

      # 6. Confirmar cambios en archivos JSON
      - name: Commit JSON Changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git switch --orphan data
          git add bossraid.json eggs.json noticias.json rankshiny.json destacados.json raid_hour.json shinys.json
          git commit -m "Datos actualizados ü§ñüç∫"

      # 7. Eliminar carpeta temporal
      - name: Clean Temp Folder
        run: rm -r temp

      # 8. Hacer push de la rama `data`
      - name: Push Data Branch (JrVM)
        uses: ad-m/github-push-action@v0.6.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: data
          force: true
